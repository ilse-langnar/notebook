<div data-ilse-id="url-bar.html" data-ilse-icon="menu.svg" >

        <style>

            /* .tab */
            .tab {
                box-shadow: rgb(50 50 93 / 25%) 0px 2px 5px -1px, rgb(0 0 0 / 30%) 0px 1px 3px -1px;
                border-radius: var( --border-radius );
                padding: 3px;
                margin-left: 5px;
            }

            .tab:hover {
                /*border: 1px solid #000;*/
                cursor: pointer;
            }

            /* p */
            .tab p {
                display: none;
            }

            .tab:hover p {
                display: inherit;
            }

            /* img */
            .tab img.remove {
                /*display: none; */
            }

            .tab:hover img.remove {
                display: inherit;
            }

        </style>

    </div>
    <style>
        #url-bar {
        }

            #url-bar .box {
                position: absolute;
                top: 40px;
                width: 80%;
                z-index: 4;
                border: 1px solid var( --secondary );
                background: #fff;
                color: #000;
                border-radius: var( --border-radius );
                padding: 3px;
            }

            #url-bar #which-key .key {
                width: 15%;
                height: 25px;
                overflow: hidden;
                margin-left: 5px;
                margin-bottom: 5px;
                background: var( --primary );
                color: var( --secondary );
                cursor: pointer;
            }

            #url-bar #which-key .key:hover {
                background: var( --secondary );
                color: var( --primary );
                }

        #url-bar input:focus {
            outline: none !important;;
        }

        #url-bar .key {

        }

            #url-bar .key .combo  {
                color: var( --accent );
            }

            #url-bar .key .arrow  {
                color: var( --terciary );
                margin-left: 2px;
                margin-right: 2px;
            }

            #url-bar .key .command  {
                color: var( --terciary );
            }

    </style>


    <div x-show="$store.config.is_url_bar_on" id="url-bar" >

        <style>
            #url-bar-container {
                height: 38px;
                box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
                margin-top: 5px;
                width: 99%;
                margin: 5px auto;
                border-radius: var( --border-radius );
                padding: 1px;
            }
        </style>

        <div class="flex space-between" id="url-bar-container" x-data="{ open: '' }" >

            <!-- FEATURE: Open/Close via messages -->
            <img class="cursor-pointer"
                style="width: 25px; margin: 10px;"
                :title=" seconds ? 'Saving in ' + seconds : 'Ilse Langnars Notebook' "
                :src="seconds ? api.require('cloud.svg') : api.require('icon.svg')"
                x-data="{ seconds: $store.autosave }"
                x-init="$watch( '$store.autosave', payload => {

                    /*
                    if( payload === 0) {
                    } else {
                        setTimeout( () => {
                            api.notes.save()
                            api.store( 'autosave', 0 )
                        }, payload )
                    }
                    */

                    seconds = payload;
                })" x-transition.opacity />

            <!-- <img class="cursor-pointer" style="width: 25px; margin: 10px;" :src="api.require('settings.svg')" />

            <img class="cursor-pointer" style="width: 25px; margin: 10px;" :src="$store.config.is_leftsidebar_on ? api.require('eye.svg') : api.require('eye-off.svg')" @click="let config = $store.config; config.is_leftsidebar_on = !config.is_leftsidebar_on; api.store('config', config)" /> -->

            <!-- <img class="cursor-pointer" style="width: 25px; margin: 10px;" :src="$store.config.is_leftsidebar_on ? api.require('eye.svg') : api.require('eye-off.svg')" @click="let config = $store.config; config.is_leftsidebar_on = !config.is_leftsidebar_on; /*Make main.html box adaptable to isu_url_bar_on so it growns and contracts accordingly. */ config.is_url_bar_on = !config.is_url_bar_on; api.store('config', config)" /> -->
            <img class="cursor-pointer" style="width: 25px; margin: 10px;" :src="api.require('calendar.svg') " @click="" />

            <!-- Close all boxes on 'esc' -->
            <div x-text="api.on( '~keyboard', key => { if( key === 'esc' ) open = ''; })" > </div>
            <!-- /Close all boxes on 'esc' -->

            <img style="width: 25px; margin: 10px; cursor: pointer;" :src="api.require('clipboard-typography.svg')" @click="open = 'refs'" />
            <p style="position: relative; left: -15px; font-family: var(font-family3), serif; " > 0 </p>

            <!-- <img style="width: 25px; margin: 10px; cursor: pointer;" :src="api.require('brackets.svg')" :class=" open === 'refs' ? 'border-bottom' : '' " @click="open = 'refs'" />

            <p x-text="$store.links.length" style="position: relative; left: -15px; font-family: var(font-family3), serif; " ></p>

            <style>
                #references-panel {
                    position: absolute;
                    top: 40px;
                    width: 80%;
                    left: 1%;
                    min-height: 70vh;
                    max-height: 70vh;
                    overflow: auto;
                    z-index: 4;
                    background: var( background-color );
                    color: var( text-color );
                    border-radius: var( border-radius );
                    padding: 4px;
                    box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px, rgba(0, 0, 0, 0.3) 0px 1px 3px -1px !important;
                }
            </style>
            <div x-show="open === 'refs' " id="references-panel" x-init="$watch( '$store.links', change => { list = change }) " @click="open = 'refs' "x-data="{ list: $store.links }" >

                <div align="center" >

                    <style>
                       #references-panel input.input {
                            color: var( text-color );
                            background: var( background-color );
                            border-radius: var( border-radius );
                            width: 90%;
                            margin-top: 10px;
                            margin-bottom: 10px;
                        }
                    </style>
                    <br>
                    <template x-for="( item, index ) in list" >
                        <a :href=" '#' + item " x-text=" '#' + item" style="margin-left: 10px;" ></a>
                    </template>
                </div>

                <template x-for="( item, index ) in list" :key="index" >
                    <div :id="item" >
                        <hr>
                        <img :src="api.require('x.svg')" alt="Close" title="Close" style="width: 20px; float: right; margin-right: 10px; cursor: pointer;" @click="list.splice( index, 1 )" >
                        <h2 align="center" x-text="item" ></h2>
                        <span x-html="api.component('outline.html', { list: api.notes.query(item), 'url-bar.html' })" ></span>
                        <hr>
                    </div>
                </template>

            </div> -->

            <img style="width: 25px; margin: 10px; cursor: pointer;" :src="api.require('keyboard.svg')" :class=" open === 'keyboard' ? 'border-bottom' : '' " @click="open = 'keyboard' " @click.away="if( open === 'keyboard' ) open = '' " />
            <!-- Keyboard Shortcuts -->

            <style>
                #keyboard-shortcuts-panel {
                    position: absolute;
                    top: 40px;
                    width: 80%;
                    left: 1%;
                    z-index: 4;
                    border: 1px solid var( --secondary );
                    background: #fff;
                    color: #000;
                    border-radius: var( --border-radius );
                    padding: 3px;
                }
            </style>
            <div x-show="open === 'keyboard' " id="keyboard-shortcuts-panel" x-data="{ key: '' }" >

                <!-- FEATURE: Open/Close via messages -->
                <div x-text="api.on( '~keyboard', key => {

                    if( key === 'esc' ) open = '';

                    if( key === 'C-SPC' ) {

                        let start   = api.last_called_command_time
                            if( !start ) {
                                open = 'keyboard'
                                api.last_called_command_time = null
                            }

                        let now     = (new Date().getTime() )
                        let timeout = (new Date().getTime() ) - api.last_called_command_time

                        if( timeout > 1000 ) {
                            open = 'keyboard';
                            api.last_called_command_time = null
                        }
                    }

                })" > </div>

                <!-- Close -->
                <style>
                    #close-keyboard-shortcuts-panel {
                        width: 20px;
                        float: right;
                        margin-right: 10px;
                        cursor: pointer;
                    }
                </style>
                <img x-show="open === 'keyboard' " id="close-keyboard-shortcuts-panel" :src="api.require('x.svg')" alt="Delete" title="Delete" @click="height = 25; tab = '' " >
                <p style="text-align: center;" > Keyboard Shortcuts </p>
                <hr style="clear: both; margin-top: 20px; " >
                <!-- Close -->

                <!-- Default: Which Key -->
                <div id="which-key" x-show="open === 'keyboard' " >

                      <template x-for="(item, index) in api.keyboard.keys" >
                          <div x-show="key === ' ' ? true : item.combo.indexOf(key) !== -1" class="key is-pulled-left" style="margin: 5px; " @click="api.commands.run(item.command)" >
                              <span class="combo" x-text="item.combo.replace('ctrl+space', '')" > </span>
                              <span class="arrow" > &rarr; </span>
                              <span class="command" x-text="item.command" > </span>
                          </div>
                      </template>
                  </div>
                  <!-- Default: Which Key -->
            </div>
            <!-- Keyboard Shortcuts -->

            <input class="flexi" type="text" name="" id="" value="" x-data="{ search: '' }" x-model="search" placeholder="ilse.design or [[Design]] or #todo or !component-name" style="height: 30px; margin: 3px; border-radius: var( --border-radius ); border: 1px solid var( --secondary ); border: 1px solid transparent; padding: 3px; color: var( --secondary ); background: var( --primary ); " @keydown.enter="console.log(search); if( search.indexOf('://') !== -1 ) {
                $store.tabs.add_component('web.html', 'Browser', { url: search })
               } else if( search[0] === '!' ) {
                   let clean_string = search.replace('!', '')
                   console.log('search -> ', search )
                   console.log('clean_string -> ', clean_string )
                   $store.tabs.add_component(clean_string, 'Component', {  })
               } else if( search.slice(-3) === '.md' ) { // has a .md

                   let exists  = api.fs.existsSync( search )

                   $store.tabs.add_component('file.html', search , { file: exists ? search : null })

               } else {
                   $store.tabs.add_component('references.html', 'References', { file: search })
               }

              " >


            <!-- <img class="flexi" style="width: 25px; cursor: pointer; margin-left: 15px;" :src="api.require('plus.svg')" title="New Plugin" alt="Make" @click="$store.tabs.add()" />  -->
            <!-- <template x-for="(item, index) in $store.tabs.list" :key="index" class="flexi" >
                <span >
                    <div x-text="item.components.length" style="font-size: 1.2em;" > </div>
                    <img style="width: 25px; cursor: pointer; margin: 2px; " :src="api.require('icon.svg')" title="New Plugin" alt="Make" @click="$store.tabs.select(item)" />
                    <p x-text="item.name" @click="console.log('item -> ', item);" > </p>
                    <img class="remove" style="width: 20px !important; cursor: pointer;" :src="api.require('x.svg')" title="Delete" alt="Make" @click="$store.tabs.remove_component(item)" />
                </span>
            </template> -->

            <!-- User Defined Plugins -->

            <!-- <img style="width: 25px; margin: 10px; cursor: pointer;" :src="api.require('settings.svg')" :class=" open === 'refs' ? 'border-bottom' : '' " @click="open = 'refs'" /> -->

            <!--Top Menu Plugins -->
            <!-- <div x-data="{ list: [] }" x-init="api.on('~ilse', payload => { if( payload === 'loaded' ) { list = api.plugins; console.log('list -> ', list)} })"> -->

                <template x-for="(item,index) in list" :key="index" x-data="{ list: [] }" x-init="api.on('~ilse', payload => { if( payload === 'loaded' ) { list = api.get('plugins'); } })">
                    <template x-if="api.component(item).indexOf('data-ilse-invisible') === -1" >
                        <span x-html="api.component(item)" @click="console.log('item -> ', item); " style="display: inline; float: left; "></span>
                    </template>
                    <!-- <template x-if="!item.configuration.is_headless" >
                        <span x-html="api.components[item]" @click="console.log('item -> ', item); " style="display: inline; float: left; "></span>
                    </template> -->
                </template>

                <img style="width: 25px; margin: 6px; cursor: pointer;" :src="api.require('plus.svg')" @click="api.commands.run('open-make-plugin-modal')" title="New Plugin" alt="Make" />

            <!-- </div> -->
        </div>
</template> 
