<div data-ilse-id="contextmenu.html" data-ilse-icon="pointer.svg" >
    <div id="contextmenu" >

        <div class="context-menu"
         x-data="{
             is_on: false,
             x: -1,
             y: -1,
             mousemove: event => {
                 if( $data.x === -1 ) {
                     $data.x = event.clientX; $data.y = event.clientY
                 }
             }
         }"

         x-show="is_on && x !== -1"
         @click="document.removeEventListener( 'mousemove', mousemove ); is_on = false; x = -1; y = -1; /*after closing context menu, clean it*/ api.store('contextmenu', []); "
         x-init="contextmenu('##contextmenu'); document.addEventListener('contextmenu', event => {

            is_on = !is_on
            api.store('selection', window.getSelection().toString() )

            if( is_on ) {
                document.addEventListener( 'mousemove', mousemove )
            } else {
                document.removeEventListener( 'mousemove', mousemove )
                x = -1
                y = -1
                api.store('contextmenu', []);
            }
        });
        api.on( '~keyboard', key => { if( key === 'esc' ) is_on = false; })
        "

        :style="'left: ' + x + 'px;' + 'top: ' + y + 'px;' " @click.away="is_on = false; x = -1; y = -1; document.removeEventListener('mousemove', mousemove); " >

            <div style="display: flex;" class="cursor-pointer" @click="navigator.clipboard.writeText( api.store('selection') )" >
                <p x-text="'Copy'" style="font-size: 1em; flex: 1; flex-basis: 90%; " ></p>
                <img :src="api.require('copy.svg')" alt="" style="flex: 1; flex-basis: 20%; width: 20px;" >
            </div>

            <div style="display: flex;" class="cursor-pointer" @click="let selection = window.document.getSelection().toString(); if( selection ) {

                let links = api.store('links');
                    links.push( selection );
                api.store('links', links);
            }" >
                <p x-text="'Linked Refs'" style="font-size: 1em; flex: 1; flex-basis: 90%; " ></p>
                <img :src="api.require('brackets.svg')" alt="" style="flex: 1; flex-basis: 20%; width: 20px;" >
            </div>

            <div style="display: flex;" class="cursor-pointer" @click="" >
                <p x-text="'Test'" style="font-size: 1em; flex: 1; flex-basis: 90%; " ></p>
                <img :src="api.require('test-pipe.svg')" alt="" style="flex: 1; flex-basis: 20%; width: 20px;" >
            </div>

            <div
                x-show="$store.contextmenuevent && $store.contextmenuevent.target.tagName === 'IMG' " class="flex cursor-pointer"
                x-data="{ is_on: false }"
                @click="let base64 = api.utils.dom_img_2_base64(api.store('contextmenuevent').target); navigator.clipboard.write([ new ClipboardItem({ 'image/png': api.utils.base64_2_file(base64) }) ]); api.notify('Copied Image', 'Image Copied to Clipboard' );" >

                <p x-text="'Copy Image'" style="font-size: 1em; flex: 1; flex-basis: 90%; " ></p>
                <img :src="api.require('package.svg')" alt="" style="flex: 1; flex-basis: 20%; width: 20px;" >
            </div>


            <hr x-show"$store.contextmenu.length" >

            <template x-for="(item, index) in $store.contextmenu" x-data="{ list: $store.contextmenu }" :key="index" >
                <div style="display: flex;" class="space-around cursor-pointer" :title="item.description" >
                    <p x-text="item.name" style="font-size: 1em; flex: 1; flex-basis: 90%; " ></p>
                    <img :src="api.require(item.icon)" alt="" style="width: 20px; flex: 1; flex-basis: 20%; " >
                </div>
            </template>
        </div>
    </div>
    <style>
        #contextmenu .context-menu {
            position: absolute;
                position: fixed;
            height: 200px;
                height: auto;
            /*min-height: 200px;*/
            width: 160px;
            background: #fff;
            border-radius: var( --border-radius );
            padding: 8px;
            box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
            z-index: 4;
        }
    </style>
</div>
