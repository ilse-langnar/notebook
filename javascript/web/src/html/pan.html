<div data-component-id="pan" id="pan" class="no-outline" style="overflow: auto;  height: fit-content; border: 1px solid #000; width: 100vw; " x-data="{ list: []  }" x-transition
    x-init="ilse.libs.panzoom(document.querySelector('#pan #container'), {
         pinchSpeed: 1,
         /*beforeWheel: e => { return true; let ignore = !e.altKey; return ignore },*/
         filterKey: function(/* e, dx, dy, dz */) { return true; },
         beforeMouseDown: e => {
             let ignore = !e.button === 1;
             return ignore
         },
    })" >

    <div id="container" x-init="window.ilse.Messager.on('~ilse', (action) => { if( action === 'loaded' ) { list = window.ilse.query_regexp( '^' + day, 'ig' ) } })" style="padding: 40px;" >

        <template x-for="(note, index) in list" :key="index" >
            <div style="max-width: 300px; " >


                <div x-show="!note.is_editing" class="render" @click="if( $event.target.type === 'checkbox' ) {
                    ilse.notes.list[note.id].content.replace( '- [ ]', '- [x]' )
                    note.is_editing = false;
                 } else {
                    note.is_editing = true;
                    setTimeout( () => {let dom = document.getElementById( note.id + '-edit' ); dom.focus() }, 10 )
                 } " x-html="ilse.markdown.render(note.content)" style="height: fit-content; overflow: hidden;" @blur="note.is_editing = false; ilse.notes.list[note.id].content = $event.target.innerText; ilse.notes.save()" > </div>

                <div x-show="note.is_editing" :id="note.id + '-edit' " class="edit" x-text="note.content" contentEditable @blur="console.log('blur'); note.is_editing = false; ilse.notes.list[note.id].content = $event.target.innerText; ilse.notes.save()" style="height: fit-content; overflow: hidden;" > </div>

            </div>
        </template>

    </div>

</div>
<style>

#pen .render {
    outline: none;
}

#pen .render img:hover {
    position: fixed;
    left: 50%; 
    top: 50%;
    transform: translate( -50%, -50% );
    width: 100px;
}

</style>
