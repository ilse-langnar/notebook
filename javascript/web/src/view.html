<div>

    <div x-ilse data-ilse-id="ilse.html" data-ilse-name="Ilse" data-ilse-icon="icon.svg" >

        <div >
            <!-- <span x-html="api.render('theme.html')"></span>
            <span x-html="api.render('url-bar.html')"></span>
            <span x-html="api.render('main.html')"></span>
            <span x-html="api.render('contextmenu.html')"></span> -->
        </div>
    </div>

    <div x-ilse data-ilse-id="theme.html" data-ilse-name="Theme" data-ilse-icon="plugin.svg" >
        <div id="theme" >

            <style type="text/css" media="all">
            :root, .ilse[data-theme='light'] {

                --background-color: #EFEFEF;
                    --background-color: #eee;
                    --background-color: #e6e6e6;
                    --background-color: #edfffc;
                    --background-color: #e6e6e6;
                    --background-color: #efefef;

                --secondary-background-color: #CED8E0;
                    --secondary-background-color:  #eef5f5;

                --terciary-background-color: #E8E8E8;

                --text-color: #717171;
                --secondary-text-color: #3c3b3b;
                --terciary-text-color: #8D9EAC;

                --border: 1px solid #4a4a4a;
                --border-radius: 6px;

                --padding: 4px;

                --font-family: Mary, Helvetica, Georgia, Times New Roman, serif, -apple-system, system-ui, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
                --font-size: 1em;

                --link-color: #5ec7b8;
                --secondary-link-color: #70a7a8;
            }

            .ilse[data-theme="dark"] {

                --background-color: #131313ff;

                --secondary-background-color: #DCEAF8;
                    --secondary-background-color: #000;

                --terciary-background-color: #5a6269;

                --text-color: #F8F8F8;
                --secondary-text-color: #E8E8E8;
                --terciary-text-color: #8D9EAC;

                --border: 2px solid #777;
                --border-radius: 6px;

                --padding: 4px;

                --font-family: Mary, Helvetica, Georgia, Times New Roman, serif, -apple-system, system-ui, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
                --font-size: 1em;

                --box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;

                --link-color: #5ec7b8;
                --secondary-link-color: #99c6c2;
            }

            .note-embed {
                background: var( --terciary-background-color  );
                margin-left: 13px;
                padding: 20px;
                border-radius: 10px;
            }
            </style>

        </div>

    </div>

    <div data-ilse-id="make-plugin.html" data-ilse-icon="plugin.svg" id="make-plugin" x-data="{ props: {} }">
        <style> 
            #make-plugin img.option {
                width: 20px !important;
                flex-basis: 10% !important;
                cursor: pointer;
            }

            #make-plugin .container {
                flex-basis: 90%;
            }
        </style>

        <div class="flex" x-data="{ selected: 'dev' }" >

            <div>
                <img class="img option" :src="api.require('building-store.svg')" :style=" selected === 'marketplace' ? 'border-bottom: 1px solid #000;' : '' " @click="selected = 'marketplace' " >
                <br>
                <img class="img option" :src="api.require('prompt.svg')"  :style=" selected === 'dev' ? 'border-bottom: 1px solid #000;' : '' "         @click="selected = 'dev' " >
                <br>
                <img class="img option" :src="api.require('address-book.svg')" :style=" selected === 'docs' ? 'border-bottom: 1px solid #000;' : '' "   @click="selected = 'docs' " >
            </div>

            <!-- Marketplace -->
            <div x-show="selected === 'marketplace' " class="container" >
                <h2> Marketplace </h2>
            </div>

            <!-- Make Plugin -->
            <div x-show="selected === 'dev' " class="container" x-data="{ code: api.get('constants').DEFAULT_PLUGIN_CODE }" >
                <div style="flex: 1;" >
                    <style>

                    #make-plugin textarea {
                        resize: none;
                        width: 100%;
                        height: 50vh;
                        padding: 10px;
                    }

                    #make-plugin textarea:focus {
                        outline: none !important;
                    }

                    #make-plugin .flex p.tag  {
                        cursor: pointer;
                    }
                    </style>
                    <div class="flex" >
                        <p class="tag" > #API </p>
                        <p class="tag" > #tutorial </p>
                        <p class="tag" > #documentation </p>
                        <p class="tag" > #hello </p>
                        <p class="tag" > #querying </p>
                    </div>
                    <textarea name="" x-model="code" > </textarea>
                </div>
                <div style="flex: 1;" >
                    <span x-html="code" ></span>
                </div>
            </div>

            <!-- Documentation -->
            <div x-show="selected === 'docs' " class="container" >
                <p> Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. </p>
            </div>

        </div>
    </div>

    <div data-ilse-id="box.html" data-ilse-icon="package.svg" >
        <div id="box" x-data="{ props: {} }" >
            <div x-html="props.html" > </div>
        </div>
    </div>

    <div data-ilse-id="contextmenu.html" data-ilse-icon="pointer.svg" >
        <div id="contextmenu" >

            <div class="context-menu"
             x-data="{
                 is_on: false,
                 x: -1,
                 y: -1,
                 mousemove: event => {
                     if( $data.x === -1 ) {
                         $data.x = event.clientX; $data.y = event.clientY
                     }
                 }
             }"

             x-show="is_on && x !== -1"
             @click="document.removeEventListener( 'mousemove', mousemove ); is_on = false; x = -1; y = -1; /*after closing context menu, clean it*/ api.store('contextmenu', []); "
             x-init="document.addEventListener('contextmenu', event => {

                is_on = !is_on
                api.store('selection', window.getSelection().toString() )

                if( is_on ) {
                    document.addEventListener( 'mousemove', mousemove )
                } else {
                    document.removeEventListener( 'mousemove', mousemove )
                    x = -1
                    y = -1
                    api.store('contextmenu', []); 
                }
            });
            api.on( '~keyboard', key => { if( key === 'esc' ) is_on = false; })
            "

            :style="'left: ' + x + 'px;' + 'top: ' + y + 'px;' " @click.away="is_on = false; x = -1; y = -1; document.removeEventListener('mousemove', mousemove); " >
                
                <div style="display: flex;" class="cursor-pointer" @click="navigator.clipboard.writeText( api.store('selection') )" >
                    <p x-text="'Copy'" style="font-size: 1em; flex: 1; flex-basis: 90%; " ></p>
                    <img :src="api.require('copy.svg')" alt="" style="flex: 1; flex-basis: 20%; width: 20px;" >
                </div>

                <div style="display: flex;" class="cursor-pointer" @click="let selection = window.document.getSelection().toString(); if( selection ) {

                    let links = api.store('links');
                        links.push( selection );
                    api.store('links', links);
                }" >
                    <p x-text="'Linked Refs'" style="font-size: 1em; flex: 1; flex-basis: 90%; " ></p>
                    <img :src="api.require('brackets.svg')" alt="" style="flex: 1; flex-basis: 20%; width: 20px;" >
                </div>

                <div style="display: flex;" class="cursor-pointer" @click="" >
                    <p x-text="'Test'" style="font-size: 1em; flex: 1; flex-basis: 90%; " ></p>
                    <img :src="api.require('test-pipe.svg')" alt="" style="flex: 1; flex-basis: 20%; width: 20px;" >
                </div>

                <div
                    x-show="$store.contextmenuevent && $store.contextmenuevent.target.tagName === 'IMG' " class="flex cursor-pointer"
                    x-data="{ is_on: false }"
                    @click="let base64 = api.utils.dom_img_2_base64(api.store('contextmenuevent').target); navigator.clipboard.write([ new ClipboardItem({ 'image/png': api.utils.base64_2_file(base64) }) ]); api.notify('Copied Image', 'Image Copied to Clipboard' );" >

                    <p x-text="'Copy Image'" style="font-size: 1em; flex: 1; flex-basis: 90%; " ></p>
                    <img :src="api.require('package.svg')" alt="" style="flex: 1; flex-basis: 20%; width: 20px;" >
                </div>


                <hr x-show"$store.contextmenu.length" >

                <template x-for="(item, index) in $store.contextmenu" x-data="{ list: $store.contextmenu }" :key="index" >
                    <div style="display: flex;" class="space-around cursor-pointer" :title="item.description" >
                        <p x-text="item.name" style="font-size: 1em; flex: 1; flex-basis: 90%; " ></p>
                        <img :src="api.require(item.icon)" alt="" style="width: 20px; flex: 1; flex-basis: 20%; " >
                    </div>
                </template>
            </div>
        </div>
        <style>
            #contextmenu .context-menu {
                position: absolute;
                    position: fixed;
                height: 200px;
                    height: auto;
                /*min-height: 200px;*/
                width: 160px;
                background: #fff;
                border-radius: var( --border-radius );
                padding: 8px;
                box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
                z-index: 4;
            }
        </style>
    </div>

    <div data-ilse-id="canvas.html" data-ilse-icon="chalkboard.svg" x-data="{}" >
        <div id="canvas" >
            <div id="canvas-wrapper" x-init="" >
                <!-- <canvas x-init="api.utils.create_infinite_canvas($el); " @mouseenter="$el.style.cursor = 'cell'; " @mouseleave="$el.style.cursor = 'auto'; " > </canvas> -->
                <!-- <canvas x-init="api.utils.create_infinite_canvas($el); " @mouseenter="$el.style.cursor = 'cell' " @mouseleave="$el.style.cursor = 'auto'; " > </canvas> -->
            </div>
        </div>
    </div>

    <div data-ilse-id="daily-notes.html" data-ilse-icon="calendar.svg" >
        <div id="daily-notes" x-transition x-data="{}" style="height: auto; margin: 10px; width: 99%; overflow: auto; height: 87vh; " >
            <img class="component-icon" :src="api.require('notes.svg')" alt="Notes" title="Notes" x-data="{}" >
            <!-- Days -->
            <div x-data="{ list: [ api.utils.get_unique_date_id().slice(0, 8)  ], today: api.utils.get_unique_date_id().slice(0, 8) }" >
                <template x-for="(item, index) in list" :key="index" >

                    <!-- day, Root -->
                    <div style="padding: 10px; " x-data="{ list: api.notes.query_regexp( new RegExp( '^' + item ) ) }" >
                        <!-- Date + Delete -->
                        <div style="display: flex;">
                            <h1 style="center !important; color: var( --text-color );" x-text=" '&bull; &nbsp; ' + api.utils.yyyymmddhhss_to_pretty(item)" > </h1>
                            <img x-show="index !== 0" :src="api.require('x.svg')" style="width: 20px;margin-left:20px;cursor:pointer;" alt="" title="Delete" @click="list.splice( index, 1 )" >
                        </div>
                        <br>

                        <p x-html="api.render('outline.html', { list: list }, { f: 'daily-note' })" ></p> 

                        <button x-show="!list.length" class="load-more" @click="let fn = async function() {
                             let text    = await api.commands.run( 'html-list', { placeholder: 'Write your first note' })
                             api.notes.add( text )
                             api.store('autosave', 60000) = true
                             // $store.store('autosave') = true
                         }
                         fn()
                        " > Write your first idea </button>

                    </div>

                </template>
            <button class="load-more" @click="let yesterday = api.utils.get_yesterday(today); list.push( yesterday ); today = yesterday" x-text=" 'Load: ' + api.utils.yyyymmddhhss_to_pretty(api.utils.get_yesterday(today) )" > </button>
            <br>

            </div>
        </div>

        <style>
        #daily-notes {
            height: 91vh;
            height: 99vh;
        }

        #daily-notes .load-more {
            display: block;
            color: var( --text-color );
            background: var( --background-color );
            padding: 7px;
            border-radius: var( --border-radius );
            margin: 0 auto;
            text-align: center;
            margin-top: 10px; 
        }

        </style>

    </div>

    <div data-ilse-id="main.html" data-ilse-icon="tech-box.svg" >
        <div id="main" x-transition x-data="{ components: $store.tabs.list.filter( item => item.is_selected )[0].components, is_select_component_on: false, is_left_sidebar_expanded: false, tab: 'ilse' }" class="flex" >


            <!-- Left Sidebar -->
            <div x-show="$store.config.is_leftsidebar_on" x-transition.opacity class="left-sidebar" style="min-width: 60px; flex-basis: 3%; /*margin-top: -48px; */" >

                <!-- Tabs -->
                <div style="width: 60px;" >

                    <div x-show="is_left_sidebar_expanded" x-transition.opacity style="width: 2px; height: 93vh; border-radius: 26px; float: right; border: 1px solid var( --text-color ); " > </div>

                    <br>

                    <style> 

                        .plugin-icon {
                            height: 50px !important;
                        }

                        .plugin-icon img {
                            width: 40px !important;
                            display: block;
                            margin: 0 auto !important;
                            margin-bottom: 4px !important;
                            padding: 3px !important;
                            border-radius: var( --border-radius );
                            box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px, rgba(0, 0, 0, 0.3) 0px 1px 3px -1px; 
                            cursor: pointer;
                        }
                    </style>

                    <!-- CHANGED -->
                    <template x-for="(item, index) in $store.tabs.list" :key="index" x-data="{ list: api.get('plugins') }" x-init="setTimeout( () => { list = api.get('plugins'); }, 3000 ); " >
                        <div class="plugin-icon" >
                            <span x-text="item.components.length" style="position: relative; left: 1px; top: 43px; color: var( --terciary-text-color ); font-family: monospace, serif, sans-serif; font-size: 0.9em; " ></span>
                            <img class="img" :src="item.icon" alt="" @click="$store.tabs.select(item)" >
                            <!-- <div class="plugin-icon" x-html="item.string"  > </div> -->
                        </div>
                    </template>

                    <br>
                    <img :src="api.require('plus.svg')" style="display: block; margin: 0 auto; cursor: pointer; margin-bottom: 5px; width: 35px; " title="Add new Plugin" alt="New" @click="$store.tabs.add()" />

                </div>
                <!-- Tabs -->

            </div>
            <!-- Left Sidebar -->

            <!-- Component[s] -->
            <template x-for="( item, index ) in $store.tabs.list" :key="index" style="display: flex;" >

                <template x-for="( _item, _index ) in item.components" :key=" 'index' + _index" style="display: flex;" >
                    <div x-show="item.is_selected && _item.is_on" class="menu" x-transition.opacity x-data="{ is_resizing: false, x_position: 0, width: 0 }" :style="$store.config.is_leftsidebar_on ? 'margin-right: 10px; width: 99%; overflow: hidden;' : 'width: 99%; overflow: hidden;' " >

                        <style>

                            .items-wrapper:hover img {
                                cursor: pointer;
                                flex: 1;
                                width: 20px !important;
                            }

                            .items-wrapper:hover .svg {
                                cursor: pointer;
                                flex: 1;
                                width: 20px !important;
                            }

                            

                        </style>

                        <div class="items-wrapper" style="height: 25px; " >

                            <!-- Should I have those mac-like things but with my colors? Should I have more buttons like: "float window", favorite, pin, zen-mode etc -->
                            <!-- <span class="circle" style="width: 0px !important; " > </span> -->

                            <div style="margin-left: 10px;" >
                                <img class="svg" :src="api.require('x.svg')" title="Close Window" alt="close" style="width: 0px; " @click="$store.tabs.remove_component(item)" >
                                <img class="svg" :src="api.require('app-window.svg')" title="Make Window Float" alt="float" style="width: 0px; " @click="console.time('one'); api.utils.make_dom_draggable( $el.parentNode.parentNode.parentNode, _item, { width: '50%', height: '50%' } ); console.timeEnd('one'); " >
                                <img class="svg" :src="api.require('replace.svg')" title="Put it Another Container" alt="move" style="width: 0px; " >
                            </div>

                        </div>
                            <!-- <hr> -->

                        <div class="flex" >
                            <div x-html="api.render(_item.id, _item.props)" style="width: 98%; margin: 0 auto;" @mouseenter="item.components.map( i => i.is_selected = false ); _item.is_selected = true" @click="console.log('@@@@')"> </div>
                        </div>

                    </div>
                </template>

            </template>

            <!-- Component[s] -->
        </div>

        <style>
            #main {
                height: 91vh;
                height: 97vh;
                margin-top: 10px;
                margin-top: 0px;
            }

                #main .menu {
                    background: var( --background-color ); 
                    overflow-x: hidden !important;
                    height: 85vh;
                    height: 92vh;
                    width: 99%;
                    margin: 0 auto;
                    border-radius: var( --border-radius );
                    box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
                }

                #main .note {
                    border-left: 1px solid #000;
                }

                #main .selected {
                    padding: 3px;
                    border-radius: var( --border-radius );
                    box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px, rgba(0, 0, 0, 0.3) 0px 1px 3px -1px; 
                }

                #main .left-sidebar {
                    height: 92vh;
                    width: 20px !important;
                    margin: 0px 5px;
                    overflow: hidden;
                    box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
                    border-radius: var( --border-radius );
                    background: var( --background-color ); 
                    border: 0 !important;
                    float: left;
                    display: flex;
                }

                    #main .left-sidebar .favorite {
                        cursor: pointer;
                    }

                #main .divider {
                    border-left: 1px dashed var( --text-color );
                    border-right: 1px dashed var( --text-color );
                    width: 50px;
                    cursor: pointer;
                }

        </style>

    </div>

    <div data-ilse-id="file.html" data-ilse-icon="app-window.svg" >
        <div x-transition x-data="{ file: '' }" >

            <template x-if="file.indexOf('png') !== -1 || file.indexOf('jpg') !== -1 || file.indexOf('gif') !== -1 || file.indexOf('jpeg') !== -1" >
                <img :src="file" style="width: 100%; height: 100%;" />
            </template>
        </div>
    </div>

    <div data-ilse-id="marketplace.html" data-ilse-icon="building-store.svg" x-data="{ props: {} }" >
        <div x-transition >

            <h1> Marketplace </h1>
            <p > lll </p>

                <template x-for="plugin in []" >
                    <p x-text="plugin.name"> </p>
                    <p x-text="plugin.description"> </p>
                    <p x-text="plugin.url"> </p>
                </template>
            </div>

        </div>
    </div>

    <div data-ilse-id="new-tab.html" data-ilse-icon="square.svg" >
        <div id="new-tab" x-transition x-data="{ text: '', url: '' }" class="flex" >
            <div x-init="let input = $el.querySelector('input'); if( input ) { setTimeout( () => { console.log('focusing ...'); input.focus() }, 1000 ) }" x-data="{ id: Math.random().toString().replace('0.', '') }" >

                <div x-data="{ url: '' }">
                    <input class="flexi no-outline" type="text" name="" id="" value="" x-data="{ search: '' }" x-model="search" placeholder="ilse.design or [[Design]] or #todo or !component-name" style="height: 30px; margin: 3px; border-radius: var( --border-radius ); border: 1px solid var( --text-color ); border: 1px solid transparent; padding: 3px; color: var( --text-color ); background: var( --background-color ); " @keydown.enter="$store.tabs.add_component('web.html', 'Browser', { url: search })" >
                </div>

            </div>
        </div>
    </div>

    <div data-ilse-id="notification.html" data-ilse-icon="app-window.svg" >
        <style>
            #notification {
                 max-width: 30%;
                 border-radius: var( --border-radius );
                 display: inline;
                 position: absolute;
                 right: 10px;
                 bottom: 20px;
                 padding: 1rem;
                 background: var( --background-color );
                 color: var( --text-color );
                 box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px, rgba(0, 0, 0, 0.3) 0px 1px 3px -1px !important;
                 max-width: 40vw; 
                 z-index: 100;
             }
        </style>

        <div id="notification" >
            <img class="is-pulled-right" style="width: 20px; cursor: pointer;" @click="api.get('stack').shift()" :src="api.require('x.svg')" />
            <h2 class="centered" > $title </h2>
            <hr>
            <p class="centered" > $description </p>

        </div>
    </div>

    <div data-ilse-id="outline.html" data-ilse-icon="point.svg" >
        <div id='outline' x-data style="padding: 10px; overflow: hidden;" x-init="api.on('~notes', payload => { if( payload.action === 'added' && payload.index === null ) { props.list.push( payload.id ) } })">

            <template x-for="(note_id, index) in list" x-data="{ list: props.list }" :key="note_id" > 
                <div x-data="{ is_editing: false, note: api.notes.list[note_id], content: api.notes.list[note_id].content, depth: api.notes.list[note_id].depth }" >

                    <div x-show="is_on" :id="note_id" :style=" 'margin-left:' + (note.depth * 20) + 'px;' " x-data="{ is_on: note.content.indexOf('#hide') === -1 }" >

                        <!-- Bullet -->
                        <span
                            class="bullet" :title="api.utils.get_bullet_description(note_id, api.notes.list[note_id] )" 
                            @click="navigator.clipboard.writeText(note_id); api.notify('Coped', 'Copied!', 'Copied: ' + note_id + ' To your clipboard' ); "



                            x-text="api.notes.list[api.utils.get_note_root(note_id)].content.indexOf('#hidden/collapsed') !== -1? '&ast;' : '&bull;' " > </span>

                        <!-- is_editing needs to be turned on-->
                        <!-- Editing -->
                        <div x-show="is_editing"
                             :id=" note_id + '-edit' "
                             style=""
                             :key="api.notes.list[note_id].content"

                             x-init="api.on('~focus', id => {

                                 if( note_id === id ) {
                                     is_editing = true;
                                     setTimeout( () => { $el.focus() }, 10 )
                                 }
                             })"

                             class="no-outline edit"
                             contentEditable
                             x-text="content" 
                             @blur="is_editing = false; api.notes.list[note_id].content = $event.target.innerText; note.content = api.notes.list[note_id].content; api.store('autosave', 60000)"
                             @keydown.enter.prevent="let id = api.utils.get_note_id(); api.notes.list[id] = { content: '', depth: api.notes.list[note_id].depth, id: id, source: 'll' , after: note_id }; props.list.push(id); props.list = api.utils.move_array_item( props.list, props.list.length -1, ++index); is_editing = false; let move_notes = api.store('move_notes'); move_notes.push({ parent: note_id, child: id }); api.store('move_notes', move_notes); setTimeout( () => { api.emit('~focus', id)}, 10 ); "
        store( "move_notes", [] )

                             @keydown.esc.prevent="document.activeElement.blur(); is_editing = false;"

                             @keydown.tab.prevent="let shift = $event.shiftKey
                                if( shift ) {
                                    if( note.depth === 0 ) return
                                    api.notes.list[note_id].depth--
                                } else {

                                    let copy          = Number(index)
                                        copy = copy - 1

                                    let previous_depth = api.notes.list[list[copy]].depth
                                    if( note.depth > previous_depth ) return

                                    api.notes.list[note_id].depth++
                                }
                             " 

                             @keydown.ctrl.up="let copy = _index; let previous_index = --copy;
                             if( props.list[previous_index] ) {
                                 let dom  = document.getElementById( props.list[previous_index].id );
                                 if( dom ) {
                                     props.list[previous_index].is_editing = true
                                     document.activeElement.blur()
                                     setTimeout( () => { let dom  = document.getElementById( props.list[previous_index].id + '-edit' ); if( dom ) dom.focus(); }, 1 )
                                 }
                             }"

                             @keydown.ctrl.down="let copy = _index; let next_index = ++copy;
                             if( props.list[next_index] ) {
                                 let dom  = document.getElementById( props.list[next_index].id );
                                 if( dom ) {
                                     props.list[next_index].is_editing = true
                                     document.activeElement.blur()
                                     setTimeout( () => { let dom  = document.getElementById( props.list[next_index].id + '-edit' ); if( dom ) dom.focus(); }, 1 )
                                 }
                             }"

                             > </div>
                            <!-- Editing -->

                            <!-- Displaying -->
                            <div x-show="!is_editing"
                                 class="render"
                                 :id=" note_id + 'render'"
                                 :key="api.notes.list[note_id].content"
                                 :title="api.notes.list[note_id].content"
                                 x-html="api.markdown(api.notes.list[note_id].content)"

                                 @link-click="console.log('$event.detail -> ', $event.detail); if( $event.detail.id === note_id && $store.links.indexOf($event.detail.link) === -1 ) { console.log('$event.detail -> ', $event.detail); $store.tabs.add_component('references.html', 'References', { file: $event.detail.link }) }"

                                 @dblclick="is_editing = true; setTimeout( () => {let dom = document.getElementById( note_id + '-edit' ); dom.focus() }, 10 )"

                                 @click="if( $event.target.type === 'checkbox' ) {

                                    let normalized  = api.notes.list[note_id].content.replace( '[ ]', '[x]' )
                                    api.notes.list[note_id].content = normalized

                                    is_editing = false;
                                    api.store('autosave', 60000);
                                 }

                                 if( $event.ctrlKey ) {

                                     let fn = async function() {
                                         // TODO: Make add child
                                     }
                                     fn()

                                 }
                                 if( $event.shiftKey ) navigator.clipboard.writeText( note_id ) // Copy Note Id
                                 " > </div>
                                <!-- Displaying -->

                        <!-- First Bullet -->
                    </div>

                </div>
            </template>

        </div>

        <style>
        #outline {
            height: 91vh;
            height: 99vh;
            height: auto;
        }

            #outline .note {
                border-left: 1px solid #000;
            }

            #outline .render:hover {
                text-decoration: underline;
            }

            #outline .bullet {
                margin-top:   -5px;
                    margin-top:   0px;
                text-align:   center;
                cursor:       pointer;
                color:        #a3a3a3;
                color:        var( --text-color );
                /* font-size: 1.5em; */
                width: 20px;
                cursor:       pointer;
                margin-right: 7px;
                margin-right: 0px;
                width: 10px;
                height: 10px;

                flex: 1;
                display: block;
                float: left;
                margin-right: 6px;
            }

            #outline .edit {
                flex: 1; 
                min-width: 100px;
                min-height: 30px;
                padding-left: 15px;
            }

                #outline .edit:focus {
                    outline: none;
                    content: "LLLLLLL";
                }

        #outline .render {
            flex: 1;
            /*min-width: 100px;*/
            width: fit-content;
            border: 1px solid transparent;;
            min-height: 30px;
            min-width: 100px;
            padding-left: 15px;
        }

        #outline .ghost-bullet {
            clear: both;
            min-height: 30px;
            height: fit-content;
        }

               #outline .ghost-bullet .camp {
                    flex: 1;
                    height: 32px;
                }

                    #outline .ghost-bullet .camp:focus {
                        outline: none !important;
                        border-bottom: 1px solid var( --text-color );
                    }

                #outline .ghost-bullet .bullet {
                    flex: 1;
                    display: block;
                    float: left;
                    margin-right: 6px;
                }

        </style>
    </div>

    <div data-ilse-id="references.html" data-ilse-icon="line.svg" >
        <div style="with: 100%; height: 100%; overflow: auto; height: 92vh;" x-transition x-data="{ file: '' }" >
            <span x-html="api.render( 'outline.html', { list: list } )" x-data="{ list: api.notes.query(props.file) }" ></span>
        </div>
    </div>

    <div data-ilse-id="html-list.html" data-ilse-icon="lupe.svg" >
        <div id="search" style="overflow: auto; height: 100%; border; 2px solid #000; " x-data="{ props: { on_enter() {}, on_click(){}, show_more: false, search: '', list: [], pointer: -1, prepend_search: '', append_search: '', placeholder: '', on_input: function(){} } }" >

            <!-- wrapper -->
            <div x-data="{ is_options_on: false }" x-init="props.init()" >

                <div class="flex space-between" >

                    <img :src="props.icon ? api.require( props.icon ) : api.require('logo.svg')" style="width: 30px; margin-left: 10px; cursor: pointer; " >

                    <img :src="api.require('chevron-down.svg')" style="width: 20px; cursor: pointer; " >

                    <input id="search-input"
                        x-model="props.search"
                        @keydown.up.prevent=""
                        @keydown.down.prevent=""
                        @input="props.on_input($el)"
                        @keydown.enter="props.on_enter()"
                        :placeholder="props.placeholder ? props.placeholder : 'Search for Something ...' "
                        title="[[Ilse]] [[Programming]] - [[Ilse]] AND [[Programming]] - [[Ilse]] NOT [[Programming]] - #ilse - #math/topology"
                        x-init="document.getElementById('search-input') ? document.getElementById('search-input').focus() : null; setTimeout( () => { search = '' }, 100 ) "
                        style="color: var( --text-color ); background: var( --background-color ); border-radius: var( --border-radius ); width: 90%; margin-top: 10px; margin-bottom: 10px;"/>

                    <img :src="api.require('x.svg')" style="width: 20px; margin-right: 10px; cursor: pointer; " @click="api.get('stack').pop()" >

                </div>

                <hr x-show="props.list.length" style="margin-bottom: 3px;" >

                <!-- grid -->
                <div x-show="props.list.length" style="display: flex; overflow: hidden;" >

                    <template x-for="(item, index) in props.list" :key="index" >
                        <div>
                            <p class="bullet" > &bull; </p>
                            <p class="render" x-html="api.markdown(item.replaceAll('/n', '<br>'))" @click="props.on_click($el, item, index)" > </p>
                        </div>
                    </template>

                </div>
                <!-- grid -->
            </div>
            <!-- wrapper -->

        </div>
        <style>

        #search .note {
            border-left: 1px solid #000;
        }

        #search .render:hover {
            text-decoration: underline;
        }

        #search .bullet {
            margin-top:   5px;
            text-align:   center;
            cursor:       pointer;
            color:        #a3a3a3;
            color:        var( --text-color );
            /* font-size: 1.5em; */
            width: 20px;
            cursor:       pointer;
            margin-right: 7px;
            margin-right: 0px;
            width: 10px;
            height: 10px;

            flex: 1;
            display: block;
            float: left;
            margin-right: 6px;
        }



        #search .result {
            display: flex;
        }

        #search input:focus {
            /*box-shadow: 0 0 0 3px hsla(var(--input-focus-h), var(--input-focus-s), calc(var(--input-focus-l) + 40%), 0.8);*/
            outline: 3px solid transparent;
            border-color: hsl(var(--input-focus-h), var(--input-focus-s), var(--input-focus-l));
            border: 2px solid rgb(124, 138, 255);
        }

        #search input:not([type="checkbox"]) {
            transition: 180ms box-shadow ease-in-out;
            width: 100%;
            color: rgb(36, 35, 42);
            font-size: 16px;
            line-height: 20px;
            min-height: 28px;
            border-radius: 4px;
            padding: 8px 16px;
            border: 2px solid transparent;
            box-shadow: rgb(0 0 0 / 12%) 0px 1px 3px, rgb(0 0 0 / 24%) 0px 1px 2px;
            background: rgb(251, 251, 251);
            transition: all 0.1s ease 0s;
        }

        #search .render {
            cursor: pointer;
            margin-bottom: 5px;
            color: var( --text-color );
            background: var( --background-color );
            text-align: left;
            padding: 3px; 
        }

        #search .render:hover {
            text-decoration: underline;
        }
        </style>
    </div>

    <div data-ilse-id="setup.html" data-ilse-icon="settings.svg" >
        <div id="setup" style="font-family: Helvetica, sans, Inter; width: 70%; margin: 0 auto; "
            x-transition:enter-start="opacity-0 transform scale-90"
            x-transition:enter-end="opacity-100 transform scale-100"
            x-transition:leave="transition ease-in duration-300"
            x-transition:leave-start="opacity-100 transform scale-100"
            x-transition:leave-end="opacity-0 transform scale-90" >

            <br />
            <h1 class="centered" > Setup </h1>
            <h2 class="centered" > Select the folder for your notes. </h2>

            <br style="height: 100px;" />

            <img x-bind:src="api.require('folders.svg')" class="select-folder centered" style=" width: 40%; display: block; margin: 0 auto; border: 1px dashed #000; border-radius: 5px; cursor: pointer; " @click="api.commands.run('setup-select-target-directory')" />
         
            <p align="center" style="text-decoration: italic; text-align: center; margin: 0 auto;" > You can change it later!  </p>

        </div> 
    </div>

    <div data-ilse-id="url-bar.html" data-ilse-icon="menu.svg" >
        <div x-show="$store.config.is_url_bar_on" id="url-bar" >

            <style>
                #url-bar-container {
                    height: 38px;
                    box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
                    margin-top: 5px;
                    width: 99%;
                    margin: 5px auto;
                    border-radius: var( --border-radius );
                    padding: 1px;
                }
            </style>

            <div class="flex space-between" id="url-bar-container" x-data="{ open: '' }" >

                <!-- FEATURE: Open/Close via messages -->
                <img class="cursor-pointer" 
                    style="width: 25px; margin: 10px;"
                    :title=" seconds ? 'Saving in ' + seconds : 'Ilse Langnars Notebook' "
                    :src="seconds ? api.require('cloud.svg') : api.require('icon.svg')"
                    x-data="{ seconds: $store.autosave }"
                    x-init="$watch( '$store.autosave', payload => {

                        /*
                        if( payload === 0) {
                        } else {
                            setTimeout( () => {
                                api.notes.save()
                                api.store( 'autosave', 0 )
                            }, payload )
                        }
                        */

                        seconds = payload;
                    })" x-transition.opacity />

                <!-- <img class="cursor-pointer" style="width: 25px; margin: 10px;" :src="api.require('settings.svg')" />

                <img class="cursor-pointer" style="width: 25px; margin: 10px;" :src="$store.config.is_leftsidebar_on ? api.require('eye.svg') : api.require('eye-off.svg')" @click="let config = $store.config; config.is_leftsidebar_on = !config.is_leftsidebar_on; api.store('config', config)" /> -->

                <img class="cursor-pointer" style="width: 25px; margin: 10px;" :src="$store.config.is_leftsidebar_on ? api.require('eye.svg') : api.require('eye-off.svg')" @click="let config = $store.config; config.is_leftsidebar_on = !config.is_leftsidebar_on; /*Make main.html box adaptable to isu_url_bar_on so it growns and contracts accordingly. */ config.is_url_bar_on = !config.is_url_bar_on; api.store('config', config)" /> 

                <!-- Close all boxes on 'esc' -->
                <div x-text="api.on( '~keyboard', key => { if( key === 'esc' ) open = ''; })" > </div>
                <!-- /Close all boxes on 'esc' -->

                <img style="width: 25px; margin: 10px; cursor: pointer;" :src="api.require('brackets.svg')" :class=" open === 'refs' ? 'border-bottom' : '' " @click="open = 'refs'" />

                <p x-text="$store.links.length" style="position: relative; left: -15px; font-family: monospace, serif; " ></p>

                <style>
                    #references-panel {
                        position: absolute;
                        top: 40px;
                        width: 80%;
                        left: 1%;
                        min-height: 70vh;
                        max-height: 70vh;
                        overflow: auto;
                        z-index: 4;
                        background: var( --background-color );
                        color: var( --text-color );
                        border-radius: var( --border-radius );
                        padding: 4px;
                        box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px, rgba(0, 0, 0, 0.3) 0px 1px 3px -1px !important;
                    }
                </style>
                <div x-show="open === 'refs' " id="references-panel" x-init="$watch( '$store.links', change => { list = change }) " @click="open = 'refs' "x-data="{ list: $store.links }" >

                    <div align="center" >

                        <style>
                           #references-panel input.input {
                                color: var( --text-color );
                                background: var( --background-color );
                                border-radius: var( --border-radius );
                                width: 90%;
                                margin-top: 10px;
                                margin-bottom: 10px;
                            }
                        </style>
                        <!-- <input placeholder="Search and Filter ..." class="input box-shadow" style=""/> -->
                        <br>
                        <template x-for="( item, index ) in list" >
                            <a :href=" '#' + item " x-text=" '#' + item" style="margin-left: 10px;" ></a>
                        </template>
                    </div>

                    <template x-for="( item, index ) in list" :key="index" >
                        <div :id="item" >
                            <hr>
                            <img :src="api.require('x.svg')" alt="Close" title="Close" style="width: 20px; float: right; margin-right: 10px; cursor: pointer;" @click="list.splice( index, 1 )" >
                            <h2 align="center" x-text="item" ></h2>
                            <span x-html="api.render('outline.html', { list: api.notes.query(item) })" ></span>
                            <hr>
                        </div>
                    </template>
                    
                </div>

                <img style="width: 25px; margin: 10px; cursor: pointer;" :src="api.require('keyboard.svg')" :class=" open === 'keyboard' ? 'border-bottom' : '' " @click="open = 'keyboard' " @click.away="if( open === 'keyboard' ) open = '' " />
                <!-- Keyboard Shortcuts -->

                <style>
                    #keyboard-shortcuts-panel {
                        position: absolute;
                        top: 40px;
                        width: 80%;
                        left: 1%;
                        z-index: 4;
                        border: 1px solid var( --text-color );
                        background: #fff;
                        color: #000;
                        border-radius: var( --border-radius );
                        padding: 3px;
                    }
                </style>
                <div x-show="open === 'keyboard' " id="keyboard-shortcuts-panel" x-data="{ key: '' }" >

                    <!-- FEATURE: Open/Close via messages -->
                    <div x-text="api.on( '~keyboard', key => {

                        if( key === 'esc' ) open = '';

                        if( key === 'C-SPC' ) {

                            let start   = api.last_called_command_time
                                if( !start ) {
                                    open = 'keyboard'
                                    api.last_called_command_time = null
                                }

                            let now     = (new Date().getTime() ) 
                            let timeout = (new Date().getTime() ) - api.last_called_command_time

                            if( timeout > 1000 ) {
                                open = 'keyboard';
                                api.last_called_command_time = null
                            }
                        }

                    })" > </div>

                    <!-- Close -->
                    <style>
                        #close-keyboard-shortcuts-panel {
                            width: 20px;
                            float: right;
                            margin-right: 10px;
                            cursor: pointer;
                        }
                    </style>
                    <img x-show="open === 'keyboard' " id="close-keyboard-shortcuts-panel" :src="api.require('x.svg')" alt="Delete" title="Delete" @click="height = 25; tab = '' " >
                    <p style="text-align: center;" > Keyboard Shortcuts </p>
                    <hr style="clear: both; margin-top: 20px; " >
                    <!-- Close -->

                    <!-- Default: Which Key -->
                    <div id="which-key" x-show="open === 'keyboard' " >

                          <template x-for="(item, index) in api.keyboard.keys" >
                              <div x-show="key === ' ' ? true : item.combo.indexOf(key) !== -1" class="key is-pulled-left" style="margin: 5px; " @click="api.commands.run(item.command)" >
                                  <span class="combo" x-text="item.combo.replace('ctrl+space', '')" > </span>
                                  <span class="arrow" > &rarr; </span>
                                  <span class="command" x-text="item.command" > </span>
                              </div>
                          </template>
                      </div>
                      <!-- Default: Which Key -->
                </div>
                <!-- Keyboard Shortcuts -->

                <input class="flexi" type="text" name="" id="" value="" x-data="{ search: '' }" x-model="search" placeholder="ilse.design or [[Design]] or #todo or !component-name" style="height: 30px; margin: 3px; border-radius: var( --border-radius ); border: 1px solid var( --text-color ); border: 1px solid transparent; padding: 3px; color: var( --text-color ); background: var( --background-color ); " @keydown.enter="$store.tabs.add_component('web.html', 'Browser', { url: search })" >


                <!-- <img class="flexi" style="width: 25px; cursor: pointer; margin-left: 15px;" :src="api.require('plus.svg')" title="New Plugin" alt="Make" @click="$store.tabs.add()" />  -->
                <!-- <template x-for="(item, index) in $store.tabs.list" :key="index" class="flexi" >
                    <span >
                        <div x-text="item.components.length" style="font-size: 1.2em;" > </div>
                        <img style="width: 25px; cursor: pointer; margin: 2px; " :src="api.require('icon.svg')" title="New Plugin" alt="Make" @click="$store.tabs.select(item)" />
                        <p x-text="item.name" @click="console.log('item -> ', item);" > </p>
                        <img class="remove" style="width: 20px !important; cursor: pointer;" :src="api.require('x.svg')" title="Delete" alt="Make" @click="$store.tabs.remove_component(item)" />
                    </span>
                </template> -->

                <!-- User Defined Plugins -->

                <!-- <img style="width: 25px; margin: 10px; cursor: pointer;" :src="api.require('settings.svg')" :class=" open === 'refs' ? 'border-bottom' : '' " @click="open = 'refs'" /> -->
                
                <!--Top Menu Plugins -->
                <div x-data="{ list: api.get('plugins') }" ilse-contextmenu="function(){ return ['a', 'b', 'c'] }" >
                    <!-- <template x-for="(item, index) in api.get('plugins')" :key="index" > -->
                    <template x-for="(item, index) in list" :key="index + list.length" x-init="setTimeout( () => { list = api.get('plugins'); console.log('@@@ -> list -> ', list); }, 3000 ); " >
                        <template x-if="true/*&& item.configuration.on_menu*/" >
                            <!-- <span x-html="item.string" @click="console.log('item -> ', item); " ></span> -->
                            <span x-html="item" @click="console.log('item -> ', item); " style="display: inline; float: left; "></span>  
                            <!-- <span x-text="item" @click="console.log('item -> ', item); " > </span> -->
                        </template>
                    </template>
                    <img style="width: 25px; margin: 10px; cursor: pointer;" :src="api.require('plus.svg')" @dblclick="console.log('list -> ', list)" title="New Plugin" alt="Make" />
                    <!-- <img style="width: 25px; margin: 10px; cursor: pointer;" :src="api.require('plus.svg')" @dblclick="console.log('list -> ', list)" @click="api.commands.run('open-make-plugin-modal')" title="New Plugin" alt="Make" /> -->
                </div>


            </div>

            <style>

                /* .tab */
                .tab {
                    box-shadow: rgb(50 50 93 / 25%) 0px 2px 5px -1px, rgb(0 0 0 / 30%) 0px 1px 3px -1px;
                    border-radius: var( --border-radius );
                    padding: 3px;
                    margin-left: 5px;
                }

                .tab:hover {
                    /*border: 1px solid #000;*/
                    cursor: pointer;
                }

                /* p */
                .tab p {
                    display: none;
                }

                .tab:hover p {
                    display: inherit;
                }

                /* img */
                .tab img.remove {
                    /*display: none; */
                }

                .tab:hover img.remove {
                    display: inherit;
                }

            </style>

        </div>
        <style>
            #url-bar {
            }

                #url-bar .box {
                    position: absolute;
                    top: 40px;
                    width: 80%;
                    z-index: 4;
                    border: 1px solid var( --text-color );
                    background: #fff;
                    color: #000;
                    border-radius: var( --border-radius );
                    padding: 3px;
                }

                #url-bar #which-key .key {
                    width: 15%;
                    height: 25px;
                    overflow: hidden;
                    margin-left: 5px;
                    margin-bottom: 5px;
                    background: var( --background-color );
                    color: var( --text-color );
                    cursor: pointer;
                }

                #url-bar #which-key .key:hover {
                    background: var( --text-color );
                    color: var( --background-color );
                    }

            #url-bar input:focus {
                outline: none !important;;
            }

            #url-bar .key {

            }

                #url-bar .key .combo  {
                    color: var( --link-color );
                }

                #url-bar .key .arrow  {
                    color: var( --terciary-text-color );
                    margin-left: 2px;
                    margin-right: 2px;
                }

                #url-bar .key .command  {
                    color: var( --tertiary-text-color );
                }

        </style>

    </div>

    <div data-ilse-id="web.html" data-ilse-icon="world-www.svg" >
        <div x-transition x-data="{ url: '' }" >
            <!-- <div x-data="{ api: {} }"> -->
            <div>

                <template x-if="props.url && props.url.indexOf('http') !== -1 " >
                    <!-- <iframe id="iframe" :src=" props.url.indexOf('http') !== -1 ? props.url : 'http://' + props.url" x-init="$el.width = $el.parentNode.parentNode.scrollWidth; $el.height = $el.parentNode.parentNode.scrollHeight + 100; console.log('$el.width -> ', $el.width); console.log('$el.height -> ', $el.height);" frameborder="0" ></iframe> -->
                    <!-- <iframe id="iframe" :src="props.url" x-init="$el.width = $el.parentNode.parentNode.scrollWidth; $el.height = $el.parentNode.parentNode.scrollHeight + 100;" frameborder="0" ></iframe> -->
                    <!-- <webview :src="props.url" frameBorder="0" style="display:inline-flex; width:640px; height:480px" >  </webview> -->
                    <embed :src="props.url" style="width:500px; height: 300px;">

                </template>

                <template x-if="props.url && props.url.indexOf('http') === -1 " >
                    <!-- <button class="button" @click="console.log('api -> ', api); console.log('api.render -> ', api.render)" > Util</button> -->
                    <span x-html="api.render('references.html', { file: props.url })"></span> 
                </template>

                <!-- <webview :src="props.url" frameBorder="0" style="height: 100vh; width: 100%;" />  -->
                <!-- <webview :src="props.url" frameBorder="0" style="display:inline-flex; width:640px; height:480px" >  </webview> -->
                <!-- <webview id="foo" src="localhost" style="display:inline-flex; width:640px; height:480px"></webview>  -->
                <!-- <embed src="localhost" > </embed> -->
            </div>
        </div>
        <style>
            input.input {
                background: var( --background-color );
                color: var( --text-color );
                width: 100%;
                border: 0 !important;
                box-shadow: rgba(50, 50, 93, 0.25) 0px 2px 5px -1px, rgba(0, 0, 0, 0.3) 0px 1px 3px -1px !important;
            }
        </script>

    </div>

    <div data-ilse-id="hello-world.html" data-ilse-icon="news.svg" >
        <div x-transition >
            <p> Hello, World </p>
        </div>
    </div>

</div>
